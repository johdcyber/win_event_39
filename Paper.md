# Windows Event Code 39 and ADCS Exploitation: Privilege Escalation in Windows Environments

## Introduction 
Privilege escalation is a critical phase in post-compromise activity, as attackers seek to expand access from an initial low-privileged foothold to high-value accounts or systems. In Windows Active Directory (AD) environments, attackers have traditionally targeted well-known pathways (e.g. Kerberos attacks, token manipulation, credential theft) to elevate privileges. Recently, **Active Directory Certificate Services (ADCS)** has emerged as an **attractive new target** for escalation due to its deep integration with AD and often-overlooked security configurations ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=For%20the%20past%20several%20months%2C,and%20the%20security%20ramifications%20of)) ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=While%20AD%20CS%20is%20not,be%20extremely%20easy%20to%20misconfigure)). ADCS is Microsoft’s Public Key Infrastructure (PKI) implementation that allows an enterprise to issue and manage digital certificates for encryption, authentication, and signing. These certificates can even serve as **authentication tokens equivalent to passwords** in AD, enabling features like smart card logon ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=popularity%20the%20security%20capabilities%20around,be%20extremely%20easy%20to%20misconfigure)). Misconfigurations in ADCS can therefore be a powerful weapon for attackers – granting domain access “with the safety off” ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=match%20at%20L612%20have%20seen,have%20known%20better%E2%80%9D%20in%20this)).

Though not installed by default, ADCS is widely deployed in enterprises to support certificate-based authentication and other services ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=aspects%20of%20Active%20Directory%20have,certificate%20service%20instances%20are%20enormous)) ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=While%20AD%20CS%20is%20not,be%20extremely%20easy%20to%20misconfigure)). Historically, ADCS received less security scrutiny than core AD components ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=For%20the%20past%20several%20months%2C,from%20our%20experience%20in%20enterprise)). This changed in 2021 when new research (e.g. SpecterOps’ *Certified Pre-Owned* whitepaper) revealed **glaring vulnerabilities in common ADCS configurations** ([Exploiting AD CS: A quick look at ESC1 and ESC8 | Crowe LLP](https://www.crowe.com/cybersecurity-watch/exploiting-ad-cs-a-quick-look-at-esc1-esc8#:~:text=AD%20CS%20exploitation%20became%20mainstream,affect%20the%20exploitation%20of%20ESC1)). Multiple escalation techniques – categorized as **ESC1 through ESC8** – were identified, demonstrating that **a low-privileged domain user could potentially leverage ADCS to become a Domain Admin** ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=,enrollment%20using%20the%20affected%20template)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Attackers%20exploit%20misconfigured%20certificate%20templates,to%20authenticate%20with%20elevated%20privileges)). Since then, threat actors and penetration testers have rapidly adopted these techniques. For example, in a 2023 incident, an attacker who breached a network via VPN proceeded to exploit an ADCS configuration to **elevate to domain administrator** privileges ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)). Industry and government reports likewise list ADCS misconfigurations among the top enterprise security weaknesses ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=%2A%20ADCS%20templates%20where%20low,certificate%20enrollment%20rights%2C%20allowing%20requesters)).

In this paper, we explore Windows **Event Code 39** – a key detection signal related to certificate-based authentication – and examine how attackers abuse ADCS to escalate privileges. We will discuss the technical meaning of Event ID 39 and its relevance in detecting ADCS abuse, delve into the major ADCS exploitation techniques (ESC1–ESC8) with real-world examples, and outline defensive strategies for detection and mitigation (from monitoring Windows events and Sysmon logs to leveraging tools like Microsoft Defender for Identity). The goal is to equip cybersecurity professionals with an understanding of this emerging attack vector and how to guard against it.

## Understanding Windows Event Code 39 
Windows Event Code 39 refers to **Event ID 39** in the context of Kerberos certificate authentication on domain controllers. This event is logged by the **Key Distribution Center (KDC)** when it encounters a user certificate during logon that is **valid** but **cannot be mapped to an AD account in a secure way** ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Event%20text%20,for%20example)). In simpler terms, Event 39 indicates that a user (or computer) presented a certificate for authentication, yet the domain controller deemed the certificate’s mapping to an account as **insecure or untrusted**, and therefore **rejected the logon** ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)).

This event is closely tied to recent changes in how AD handles certificate-based logons. In May 2022, Microsoft updated the certificate mapping process (via patch KB5014754) to introduce the concept of *strong vs. weak mappings* for certificates ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Microsoft%20has%20with%20the%20patch,against%20the%20Active%20Directory%20introduced)) ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=encrypt%20data,just%20logged%20as%20a%20warning)). Prior to this, a certificate could be mapped to a user account implicitly by attributes like the **Subject Alternative Name (SAN)** or Common Name, which was considered a “weak” mapping. Attackers abused this by crafting certificates with a SAN matching a privileged user (e.g. Administrator) to impersonate that user – an issue identified as CVE-2022-26923 ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)). The 2022 update addressed this by requiring “strong” mappings: for example, the issuing Certificate Authority (CA) now embeds the account’s security identifier (SID) in a new certificate extension, and domain controllers will only accept certificate logons that have a valid explicit mapping (via the account’s `altSecurityIdentities`) or this SID extension present ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Event%20text%20,for%20example)) ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Microsoft%20has%20with%20the%20patch,against%20the%20Active%20Directory%20introduced)). If a certificate lacks a strong mapping, the KDC treats it as suspect.

**Event 39 is the telltale sign** of such a scenario. It is logged on a domain controller’s event log (source: **Microsoft-Windows-Kerberos-Key-Distribution-Center**) whenever a certificate-based authentication attempt is **denied or flagged due to weak mapping** ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)). The event details include the presented account name (if any mapping was attempted), certificate subject, issuer, serial number and thumbprint ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Event%20text%20,for%20example)) – valuable information for investigators. Typically, you might see Event 39 in two situations:

- **After installing KB5014754 (May 2022) but before full enforcement**: During the compatibility period (which lasted roughly one year), a domain controller in “audit” mode would **allow** authentication with a weakly-mapped certificate but **log Event 39 as a warning** ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=encrypt%20data,just%20logged%20as%20a%20warning)). This gave administrators time to identify and update any legitimate certificates that would be affected. In the 2023 incident mentioned earlier, the attackers’ forged certificate triggered Event 39 (a warning) on the DC – it was “valid” but did not have the new SID mapping, so the KDC logged the anomaly ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=encrypt%20data,just%20logged%20as%20a%20warning)). Because the domain hadn’t enforced the new policy yet, the attacker’s authentication succeeded despite the warning, enabling their privilege escalation.
- **After full enforcement (post May 2023)**: With enforcement enabled (or the registry `StrongCertificateBindingEnforcement` set to mode 2), the KDC will outright **deny** any certificate logon that doesn’t have a strong mapping ([KB5014754: Certificate-based authentication changes on Windows domain controllers - Microsoft Support](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16#:~:text=allowed%20if%20the%20user%20account,predates%20the%20certificate)) ([KB5014754: Certificate-based authentication changes on Windows domain controllers - Microsoft Support](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16#:~:text=2%20%E2%80%93%20Checks%20if%20there%E2%80%99s,not%20present%2C%20authentication%20is%20denied)). In this case, Event 39 likely still logs, indicating the certificate was rejected as insecure. The user would fail to authenticate. This is the ideal state from a security perspective – the event becomes an alert of a **blocked** attempt rather than just a warning.

From a **detection and forensic analysis** standpoint, Event 39 is extremely relevant. It essentially catches attempts to use certificates that **bypass normal account binding**. In a benign scenario, Event 39 might occur if a legitimate user’s smart card certificate wasn’t updated to the new mapping format – an issue an admin should fix. In a malicious scenario, Event 39 is a red flag that someone (potentially an attacker) tried to authenticate with a certificate that wasn’t properly associated with the account. For example, an attacker forging a certificate for a domain admin (without the proper SID extension) would produce exactly this event on a patched DC ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=encrypt%20data,just%20logged%20as%20a%20warning)) ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)). Security monitoring solutions and SIEMs should be tuned to alert on Event 39 occurrences, especially if the *Certificate Subject* in the event corresponds to high-privilege accounts or unusual issuers. In summary, Event 39 provides a window into certificate-based abuse attempts and is a key indicator to monitor when defending against ADCS exploitation.

## ADCS Exploitation Techniques (ESC1 – ESC8) 
Active Directory Certificate Services can be abused in numerous ways to achieve privilege escalation. Will Schroeder and Lee Christensen (SpecterOps) introduced the term **ESC (Enterprise Security Certificate) 1–8** to categorize eight common ADCS abuse scenarios ([Certificate Services (AD-CS) | The Hacker Recipes](https://www.thehacker.recipes/ad/movement/adcs/#:~:text=,dubbed%20DPERSIST1%20to%20DPERSIST3)). These range from misconfigured certificate templates to vulnerable CA settings and even NTLM relay attacks against ADCS web services. Fundamentally, all these attacks allow an adversary to obtain a **fraudulent certificate** that grants the **ability to authenticate as a privileged account** (or otherwise perform privileged actions) in the domain. Below we detail ESC1 through ESC8, including how each attack works and real-world examples where applicable:

1. **ESC1 – Misconfigured Certificate Template (Enrollee Supplies Subject)**: ESC1 is the classic case of a dangerously misconfigured certificate template that allows a low-privileged user to obtain a certificate masquerading as another user ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=,enrollment%20using%20the%20affected%20template)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Attackers%20exploit%20misconfigured%20certificate%20templates,to%20authenticate%20with%20elevated%20privileges)). Four conditions typically make a template exploitable (often all true on a template like the default *User* template in vulnerable setups): **(a)** *Overly permissive enrollment rights* – e.g. any authenticated user can enroll for this certificate; **(b)** the certificate’s intended purposes include **Client Authentication** (meaning the cert can be used to log in to services like AD); **(c)** *Enrollee Supplies Subject* – the template allows the requestor to specify certificate subject information, such as an arbitrary SAN (Subject Alternative Name); and **(d)** *No additional approval or signature requirements* – enrollment does not require manager approval or any other higher privilege sign-off ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=,enrollment%20using%20the%20affected%20template)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Templates%20vulnerable%20to%20ESC1%20have,the%20following%20configurations)). In this scenario, an attacker who has domain user credentials can enroll for a certificate using the vulnerable template, but while doing so he supplies the SAN of a **target account** (for instance, the UPN of a Domain Admin) in the certificate request. Because the template doesn’t prevent it, the CA will issue a certificate that ostensibly belongs to the attacker’s account but contains the identity (SAN) of the target. The attacker now possesses a valid certificate that **maps to the target Domain Admin account**, allowing them to authenticate as that admin (for example, to obtain a Kerberos TGT or log into services as that admin) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Attackers%20exploit%20misconfigured%20certificate%20templates,to%20authenticate%20with%20elevated%20privileges)) ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=enabling%20access%20to%20resources%20in,enrollment%20using%20the%20affected%20template)). Essentially, the domain trusts the certificate as if it were issued to the Domain Admin. This misconfiguration was leveraged in the wild via the vulnerability **CVE-2022-26923**, prior to Microsoft’s hardening patch. A notable case study is a June 2023 incident where attackers exploited a weak template to issue a cert for a domain admin account (by supplying a Domain Admin SAN), instantly elevating themselves to Domain Admin privileges ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)). Microsoft’s patch (KB5014754) and the new Event 39 behavior specifically address this abuse by requiring explicit/strong mappings for certificate logons, thereby mitigating *unpatched* ESC1 scenarios ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=encrypt%20data,just%20logged%20as%20a%20warning)) ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Microsoft%20has%20with%20the%20patch,against%20the%20Active%20Directory%20introduced)). Nevertheless, many organizations still have templates with ESC1 conditions present in production ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=ESC8,the%20time%20of%20this%20writing)), making this a pervasive risk.

2. **ESC2 – Any Purpose EKU (No specific EKU restrictions)**: ESC2 is a close variation of ESC1. In this case, the misconfiguration is that the certificate template is configured with the **“Any Purpose” Extended Key Usage (EKU)** or has **no EKU defined at all** ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=This%20is%20a%20variation%20of,must%20have%20the%20following%20configurations)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)). EKUs govern what a certificate can be used for (client auth, code signing, etc.). “Any Purpose” essentially means the certificate can be used for *any* function, including client authentication, even if that wasn’t explicitly intended. A template with an **Any Purpose (or absent) EKU** combined with similar conditions as ESC1 (enrollment open to low-priv users, no approval, etc.) can be abused to the same effect ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)). For example, suppose a template is meant for code signing and doesn’t list client authentication in EKU – an admin might wrongly assume it can’t be used to logon. But if the EKU is actually “Any Purpose,” a domain user could enroll a certificate from this template, supply a Domain Admin SAN, and end up with a certificate that *will* be accepted for authentication (since Any Purpose includes that implicitly). Thus, the attacker again forges an identity certificate for a higher-privileged account. The key difference in ESC2 is the template’s EKU laxness; otherwise, the attack method (providing a spoofed subject identity) and impact (impersonating elevated accounts) are the same as ESC1 ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=in%20ESC1,Purpose%20EKUs%20or%20no%20EKU)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=must%20have%20the%20following%20configurations%3A)). Administrators should scrutinize templates that have no specific EKU – they may unknowingly enable authentication abuse.

3. **ESC3 – Enrollment Agent Abuse**: In ESC3, the attacker targets a certificate template that grants the **Certificate Request Agent** EKU (OID 1.3.6.1.4.1.311.20.2.1) – also known as an **Enrollment Agent** certificate ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=in%20ESC1,on%20behalf%20of%20other%20principals)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC3%20)). An enrollment agent certificate allows the holder to request certificates **on behalf of another user**. It’s intended for scenarios like an admin enrolling smart card certs for users. If a low-privileged user can obtain an Enrollment Agent certificate (because of a misconfigured template), they can then abuse it to sign certificate requests for any other account. The attack typically is two-step: (a) Enroll in the vulnerable Enrollment Agent template to get an agent cert; (b) use that agent certificate to request a cert for a privileged account (using a different template that requires an agent, or even the same template if it allows agent-signed requests). For instance, the attacker could now request a Domain Admin’s user certificate or even a domain controller certificate, presenting their agent cert to the CA to prove they are authorized to do so ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=in%20ESC1,on%20behalf%20of%20other%20principals)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC3%20)). If the CA does not have additional restrictions (like limiting which agents can enroll which templates), it will issue the certificate for the attacker. The end result is again a certificate that lets the attacker impersonate a high-priv account. ESC3 misconfigurations occur when an Enrollment Agent template is made too widely available. The SpecterOps paper highlighted that some templates might inadvertently include the Certificate Request Agent EKU and be open to domain users ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=in%20ESC1,on%20behalf%20of%20other%20principals)). The mitigation is to tightly restrict who can enroll as an agent and to use **Enrollment Agent restrictions** at the CA level (which specify which templates an agent can request and for which users) ([Edit misconfigured enrollment agent certificate template (ESC3)](https://learn.microsoft.com/en-us/defender-for-identity/security-assessment-edit-misconfigured-enrollment-agent#:~:text=Edit%20misconfigured%20enrollment%20agent%20certificate,restrict%20which%20users%20are)).

4. **ESC4 – Template Access Control Vulnerabilities**: ESC4 is about weaknesses in the **Access Control Lists (ACLs) of certificate templates** themselves ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC4%20,Access%20Control)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,WritePropertyPrincipals)). Certificate templates are AD objects stored in the Configuration partition. If their permissions are misconfigured, a low-privileged user might be allowed to **modify template settings** that they normally should not. For example, if an attacker can edit the security descriptor of a template (gaining roles like *Owner*, or *Write* permissions on properties/ACL) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC4%20is%20possible%20when%20templates,the%20following%20template%20security%20permissions)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=)), they could effectively convert a safe template into a vulnerable one. An attacker with the ability to modify a certificate template could perform actions such as: adding “Domain Users” to the enrollment permissions, enabling “Enrollee Supplies Subject,” or adding “Client Authentication” to the EKUs – thereby introducing ESC1/ESC2 conditions into a template that initially wasn’t exploitable. They might also add the Certificate Request Agent EKU to create an ESC3 scenario ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=3,certificate%20template%20security%20descriptor%20grants)). In short, ESC4 is **indirect** misuse – the adversary doesn’t immediately get a certificate, but first tampers with a template’s configuration (because of weak ACL protection) and then leverages it to enroll a malicious certificate. Real-world penetration tests have found that some templates or even the Certificate Templates container can have misdelegated permissions from years of AD administration, leaving unintended groups with modify rights ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC4%20,Access%20Control)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=)). Defenders should audit who has write/owner rights on templates; only dedicated PKI admins should.

5. **ESC5 – Compromised CA / PKI Object (Golden Certificate)**: ESC5 is a **post-exploitation** scenario where the attacker has managed to gain control over the CA server itself ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC5%20,Access%20Control)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Once%20access%20is%20gained%20an,Kerberos%20ticket%20for%20the%20account)). Notably, if an attacker becomes a **local administrator on an ADCS server**, they effectively control the CA’s private key and configuration – even if they are not yet a domain admin. With admin access to the CA machine, the attacker can extract the CA’s **root or issuing certificate private key** (or abuse the CA software) to issue certificates at will. One notorious outcome is the creation of a **“Golden Certificate”**, analogous to a Golden Ticket in Kerberos. By stealing the CA’s private key, the attacker can forge a certificate for any domain user (including a Domain Admin or even a Domain Controller’s machine account) and sign it as if the CA issued it. Since the certificate chains to the trusted CA, domain controllers will accept it as valid authentication for that identity. This grants the attacker privileged access that persists as long as the certificate remains valid (which could be years, unless the CA or cert is revoked) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Certificate%20Authority%20Server%20as%20part,server%20Low%20Privileged%20Domain%20User)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=Once%20access%20is%20gained%20an,Kerberos%20ticket%20for%20the%20account)). In effect, compromising an Enterprise CA is equivalent to compromising the entire domain. Case studies of APTs abusing a compromised CA are not widely publicized (as it’s a noisier attack requiring prior access), but it’s a known risk – for example, NSA and CISA explicitly warn about actors forging certificates with stolen CA keys to escalate and persist ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=Malicious%20actors%20can%20exploit%20ADCS,paths%20may%20grant%20actors%20unauthorized)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)). Protecting the CA’s integrity (limiting who can log on to it, using HSMs for keys, etc.) is critical to prevent ESC5.

6. **ESC6 – EDITF_ATTRIBUTESUBJECTALTNAME2 (CA SAN Flag Abuse)**: ESC6 is an attack on a **CA-level configuration**. Active Directory CAs have a flag called `EDITF_ATTRIBUTESUBJECTALTNAME2` which, if enabled, allows users to specify SAN values in the *request attributes* for *any* certificate, even if the template wouldn’t normally allow the requester to supply the subject/SAN ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC6%20is%20often%20seen%20when,EDITF_ATTRIBUTESUBJECTALTNAME2%20flag%20set%20on%20CA)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20EDITF_ATTRIBUTESUBJECTALTNAME2%20flag%20applies%20to,UPN)). This flag is often enabled to accommodate legitimate needs like adding multiple SANs to web server certificates. However, it applies **globally** to the CA. Thus, if the CA is configured with this flag, any template that an attacker can enroll in (even if that template doesn’t explicitly allow user-supplied subject) becomes vulnerable to impersonation. In practice, ESC6 means an attacker can take an otherwise “safe” template that they have access to (say the default User template, which by default uses the requesting account’s name as subject) and still push a malicious SAN through the request. The CA, due to the flag, will include the attacker-specified SAN in the issued cert ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20EDITF_ATTRIBUTESUBJECTALTNAME2%20flag%20applies%20to,UPN)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20EDITF_ATTRIBUTESUBJECTALTNAME2%20flag%20applies%20to,UPN)). The outcome is similar to ESC1: the attacker ends up with a certificate that has, for example, a Domain Admin UPN in the SAN, allowing authentication as that admin. The difference is that the *weakness is at the CA*, not the template. This attack was demonstrated in the SpecterOps research; essentially, the presence of `EDITF_ATTRIBUTESUBJECTALTNAME2` turns many templates into potential ESC1 situations ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20EDITF_ATTRIBUTESUBJECTALTNAME2%20flag%20applies%20to,UPN)). One mitigating control is that toggling this flag requires administrative rights on the CA (so not everyone can just enable it – but many organizations have it on for convenience). Notably, **ESC7 and ESC6** are related: a user with certain CA privileges (ManageCA) could enable this flag (see ESC7 below) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=A%20certificate%20authority%20has%20permissions,attacks%20are%3A%20ManageCA%20and%20ManageCertificates)). Administrators should disable this flag unless absolutely needed, or upgrade to features like certificate request attestation if available.

7. **ESC7 – Vulnerable CA Access Control (CA Permissions)**: While ESC5 dealt with outright owning the CA server, ESC7 is about misconfigured **permissions on the CA** within ADCS configuration. The CA has its own ACL controlling who can perform privileged operations on it. Two important permissions are **ManageCA** and **ManageCertificates** ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC7%20,Access%20Control)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20ManageCertificates%20permission%20allows%20a,used%20to%20circumvent%20certain%20protections)). *ManageCA* allows administrative control of the CA (equivalent to being a CA officer); someone with this right can change CA settings such as enabling flags (including the SAN flag above) or even adding new certificate templates to be issued. *ManageCertificates* allows approving or denying certificate requests that are in a pending state (for templates that require approval). If an attacker (or unauthorized user) is mistakenly granted these rights on the CA (for instance, an overly broad AD group is in the CA’s ACL), they can abuse them for escalation. With **ManageCA**, an attacker could, say, enable the `EDITF_ATTRIBUTESUBJECTALTNAME2` flag (thereby executing ESC6) or even directly issue a certificate via certutil commands. With **ManageCertificates**, an attacker could submit a certificate request that normally requires approval (perhaps one that would grant high privileges) and then self-approve it, bypassing the intended oversight ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=The%20ManageCertificates%20permission%20allows%20a,used%20to%20circumvent%20certain%20protections)). While ManageCertificates alone might not directly give a cert for a different identity, it could be combined with template modifications (ESC4) or other tricks. In essence, ESC7 is about improperly delegated CA roles. A real-world example might be an organization that gave a helpdesk group the ability to approve certificates on the CA; if that account is compromised, the attacker can abuse that permission. Managing and auditing the CA’s access control (who is in the *Cert Publishers*, *CA Admins*, or *Certificate Managers* roles) is essential to prevent this kind of abuse ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,security%20settings%20within%20these%20templates)).

8. **ESC8 – NTLM Relay to ADCS HTTP Endpoints**: ESC8 is a unique attack that doesn’t require an existing user account in the domain. Instead, it abuses the **ADCS Web Enrollment and Certificate Enrollment Web Service** endpoints via an NTLM relay attack. Many ADCS deployments include a web enrollment interface (`CertSrv` and related HTTP endpoints) to allow web-based certificate requests. If these HTTP endpoints are not secured (e.g. if they allow NTLM authentication over HTTP), an attacker can perform an **NTLM relay** to obtain a certificate for a domain computer account – even a Domain Controller’s account ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC8%20%E2%80%93%20NTLM%20Relay%20to,AD%20CS%20HTTP%20Endpoints)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,T1649%5D%20for)). The most famous example of this is the **PetitPotam** attack discovered in 2021. In PetitPotam, an attacker coerces a Domain Controller to authenticate to the attacker’s machine via the MS-EFSRPC protocol, then relays that NTLM authentication to the ADCS HTTP enrollment interface (which is tricked into thinking the DC is trying to enroll for a cert). The attacker essentially convinces the CA to issue a **certificate for the Domain Controller’s machine account** to the attacker ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,T1649%5D%20for)). With a valid DC certificate in hand, the attacker can impersonate the DC (for example, perform a DCSync attack to dump credentials, or authenticate to any service as the DC). This results in full domain compromise. What makes ESC8 particularly dangerous is that it can be performed by an **unauthenticated** attacker – no domain credentials needed – as long as they can reach the vulnerable ADCS server on the network and find a way to coerce a privileged machine to authenticate to them ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,T1649%5D%20for)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)). Microsoft assigned CVE-2021-36942 to aspects of this (and recommended disabling NTLM or requiring EPA for ADCS), but many systems remain vulnerable if web enrollment is running. In practice, several ransomware and nation-state actors quickly adopted this technique after it was disclosed in mid-2021. For instance, the **PetitPotam** method was observed in attacks to elevate privileges to Domain Admin in minutes, until organizations patched or mitigated it. To exploit ESC8, the ADCS server must have the web enrollment role enabled (and usually HTTP (not just HTTPS) accessible) and at least one certificate template available for machine enrollment (most do, e.g. the default Machine or DC templates) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=A%20key%20vulnerability%20arises%20because,common%2C%20it%20can%20be%20exploited)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=AD%20CA%E2%80%99s%20that%20are%20vulnerable,ESC8%20meet%20the%20following%20conditions)). If those conditions are met, an attacker armed with a toolkit like `ntlmrelayx` (Impacket) can carry out this relay attack. The best defense is to **disable or secure ADCS Web Enrollment** – require HTTPS with strong extended protection (so NTLM can’t be relayed) or simply remove the web enrollment feature if not needed ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=match%20at%20L812%20,and%20Network%20security%20Restrict%20NTLM)).

The above ESC1–ESC8 techniques illustrate how **ADCS misconfigurations or features can open multiple paths to privilege escalation**. These range from configuration mistakes (ESC1-4) to improper access control (ESC5-7) and even protocol-level weaknesses (ESC8). Importantly, these are not just theoretical – many have been exploited in real networks. As noted, CVE-2022-26923 (related to ESC1) was used in at least one breach ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)), and the PetitPotam (ESC8) method became a common **red-team and threat actor tactic in 2021-2022** ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)). Even with Microsoft’s patches and guidance, a 2023 analysis found that **“AD CS misconfigurations outlined in 2021 are still commonly found”** in enterprises ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=ESC8,the%20time%20of%20this%20writing)). The onus is on defenders to understand and address these weaknesses before attackers (or auditors) find them.

## Detection and Mitigation 
Detecting and defending against ADCS abuse requires a combination of **monitoring for indicators (like Event 39)**, **technical controls to harden ADCS**, and **proactive auditing of the PKI configuration**. Below, we outline best practices for **detection** of ADCS exploitation attempts and **mitigation** strategies to prevent or limit these attacks. We also highlight tools and capabilities (such as Sysmon and Microsoft Defender for Identity) that can assist enterprise defenders in this domain.

### Detection Strategies 
**1. Monitor Windows Events and Logs:** Enabling and monitoring the right logs is crucial. As discussed, **Event ID 39** on domain controllers is a key indicator of suspicious certificate logons ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)). A security operations team should set alerts on Event 39, especially if the *Certificate Subject* or *Issuer* in the event corresponds to unexpected values (e.g. an admin account’s name or an unfamiliar certificate authority). In addition to Event 39, consider monitoring other certificate-related events. Domain controllers may log Event 41 in similar conditions on older OS versions ([KB5014754: Certificate-based authentication changes on Windows ...](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16#:~:text=,and%20Windows%20Server%202008%20SP2)). There are also events when certificates are issued by the CA: ADCS CAs can be configured to log every certificate request and issuance (in the CA event log). Unusual spikes of certificate issuance, especially for privileged accounts, should be investigated. If certificate templates are modified or new templates created in AD, enabling the **Directory Service Changes** audit policy can log changes to the `Configuration\Services\Public Key Services\Certificate Templates` objects (though these can be noisy). Similarly, watch for changes to the CA’s configuration in the ADCS registry or CA object (e.g. enabling the EDITF_ATTRIBUTESUBJECTALTNAME2 flag might log an admin action).

**2. Sysmon and Endpoint Monitoring:** While ADCS attacks primarily target network services and AD, endpoint monitoring can catch telltale behaviors. **Sysmon**, a Windows system monitoring tool, can log detailed events that are useful here. For example, Sysmon’s Process Creation logs can detect if tools like `certutil.exe`, PowerShell modules, or known exploit tools (Certipy, Certify) are run on a host. An attacker who has a foothold might use `certutil -template` or `certreq` commands to enumerate or request certificates – these could be flagged by command-line patterns. Sysmon can also monitor **network connections**: in an ESC8 scenario, you might see a suspicious connection from an attacker host to the `http://<CA_Server>/certsrv/` endpoint, or LDAP queries enumerating certificate templates (LDAP queries to the Configuration partition for object class `pKIEnrollmentService` or `pKICertificateTemplate`). Additionally, if an attacker retrieves a certificate and stores it as a PFX file on disk, Sysmon’s File Creation events could catch creation of files with extensions like `.pfx` or `.pem` in unusual places. Combining these signals can provide early warning of ADCS reconnaissance or abuse. For instance, Palo Alto’s Cortex XDR team noted that sequences like *DCERPC traffic to the CA followed by certutil usage on a host* could indicate certificate theft attacks ([Detecting Active Directory Certificate Services Abuse with Cortex XDR](https://www.paloaltonetworks.com/blog/security-operations/detecting-active-directory-certificate-services-abuse-with-cortex-xdr/#:~:text=XDR%20www,a%20certificate%20that%20enables)).

**3. Microsoft Defender for Identity (MDI):** Microsoft Defender for Identity (formerly Azure ATP) has introduced specialized detections for ADCS attacks. In 2023, Microsoft even released a **dedicated ADCS sensor** for MDI that can be deployed on Certificate Authority servers ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=We%20are%20excited%20to%20announce,coverage%20to%20additional%20identity%20environments)) ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=We%20are%20excited%20to%20announce,coverage%20to%20additional%20identity%20environments)). This sensor extends MDI’s visibility by monitoring ADCS-specific activities, such as certificate requests and approvals, and integrates with signals from the domain controllers. Even before the sensor, MDI had cloud-side logic to detect **“suspicious certificate usage”** – for example, when a certificate is used to authenticate in a way that hasn’t been seen before for that user, or if a certificate without the proper SID extension is used (suggesting a forged or stolen cert) ([Provoking Defender for Identity suspicious certificate usage alerts](https://nicolasuter.medium.com/provoking-defender-for-identity-suspicious-certificate-usage-alerts-dd7ee0c4985b#:~:text=Provoking%20Defender%20for%20Identity%20suspicious,certificate%20usage%20for%20Kerberos%20authentication)). These detections can raise alerts like *“Suspected Abuse of Certificates for Lateral Movement”*. The new sensor adds the ability to detect things like NTLM relay to ADCS, abnormal enrollment activities, or known patterns of tools like Certipy. For example, if an attacker using Certipy requests a certificate for a DC, the sensor could flag that as abnormal. Enterprise defenders should consider enabling this MDI ADCS sensor on their CA servers to get tailored alerts and also to receive **Secure Score** recommendations for ADCS hardening from Microsoft ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=Identity%20learn,coverage%20to%20additional%20identity%20environments)) ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=To%20put%20the%20gravity%20of,to%20compromise%20a%20single%20password)).

**4. PKI Auditing Tools:** Proactively identifying misconfigurations is a form of detection that can preempt attacks. Tools like **Certipy** (offensive) and **PSPKIAudit** (defensive) can enumerate your ADCS settings and highlight vulnerabilities. Running `Certipy find -vulnerable` (in a safe, read-only manner) with a standard user account can reveal if any templates are susceptible to ESC1–ESC6 ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=%24%20certipy%20find%20,Enterprise%20Admins%20Full)) ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=Control%20Principals%20%3A%20ESSOS.LOCAL,and%20template%20allows%20client%20authentication)). Similarly, SpecterOps’ PSPKIAudit PowerShell script will list templates with risky settings and any users/groups with dangerous CA permissions. Security teams should regularly audit ADCS using these tools or equivalent scripts, and treat any findings (e.g. “Domain Users can enroll in Template X that allows SAN specification”) as incidents to be addressed ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=,enrollment%20using%20the%20affected%20template)) ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=Control%20Principals%20%3A%20ESSOS.LOCAL,and%20template%20allows%20client%20authentication)). By detecting the vulnerable condition early, you effectively detect the potential attack before it happens.

**5. Network Monitoring for NTLM Relay:** For the specific case of ESC8 (NTLM relay), network-level detection can complement host logs. Monitor for traffic patterns like an internal machine initiating SMB/RPC to a DC followed immediately by HTTP traffic to the CA server. The PetitPotam attack, for instance, involves an attacker connecting to `LSARPC` on a DC (which might be seen as SMB Named Pipe access to \pipe\lsarpc) and then an HTTP POST to `/certsrv/mscep/` or similar on the CA. Intrusion detection systems (IDS) can also pick up NTLM negotiation messages where the target is a web service – though decoding that might be complex. Another indicator is the presence of self-signed certificate data in network traffic if the attacker uses tools that generate a CSR and then obtains a cert. While these are advanced to catch, some organizations have built detections for the PetitPotam method using correlation of logs from the DC (which might log an SMB event) and the CA (which might log an incoming request). Defender for Identity’s built-in detections also specifically look for patterns of certificate enrollment over NTLM that don’t align with normal behavior.

In summary, multiple layers of detection should be employed. Use **Event 39** and related Windows logs as a direct signal of certificate misuse; leverage **Sysmon** and EDR solutions to catch the tools and techniques used to request or deploy rogue certificates; and deploy **identity-focused sensors and analytics** (like MDI) to catch suspicious authentication events and changes in ADCS. Quick detection is crucial because once an attacker has a valid cert, they can operate covertly (as that identity) often without tripping typical password-based anomaly detection.

### Mitigation and Hardening Guidance 
Preventing ADCS exploitation involves **locking down ADCS configurations** and reducing the attack surface. Here are key mitigation steps:

- **Apply ADCS Hardening Patches and Settings:** Ensure you have applied Microsoft’s updates related to certificate authentication (such as **KB5014754**) and that you’ve moved beyond compatibility mode to **enforcement mode** for strong certificate mapping ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=compatibility%20issues%20may%20have%20prevented,the%20end%20of%20this%20post)). This means setting the registry `StrongCertificateBindingEnforcement` to require SID or explicit mappings (value 2) on all domain controllers, after addressing any legitimate certs that need updating. By enforcing strong mappings, you mitigate impersonation via ESC1/ESC6-style attacks – any certificate without the new SID extension will simply not authenticate. Microsoft and incident responders recommend this as a top defense ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=While%20CVE,the%20end%20of%20this%20post)). Additionally, consider enabling EPA (Extended Protection for Authentication) on ADCS web services if available, to thwart NTLM relay.

- **Secure the ADCS Web Enrollment:** If the web enrollment or certificate enrollment web service is not needed, **disable or uninstall it** ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,is%20needed%20on%20ADCS%20servers)). This immediately removes the ESC8 vector. If it is needed (for example, some environments use it for NDES or SCEP services for network devices), **mandate HTTPS-only** and ideally require client TLS or other mitigations so that NTLM can’t be relayed ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=match%20at%20L812%20,and%20Network%20security%20Restrict%20NTLM)). In Windows, you can enforce “Require SSL” on the `/certsrv` website in IIS ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=match%20at%20L812%20,and%20Network%20security%20Restrict%20NTLM)). Also, **disable NTLM** for that server if possible (restrict NTLM via Group Policy so that the CA server won’t accept NTLM auth) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,and%20Network%20security%20Restrict%20NTLM)). These measures ensure that an attacker cannot perform an unauthenticated relay to your CA – the PetitPotam technique would fail because the DC’s NTLM token couldn’t be used over a protected channel.

- **Tighten Certificate Template Permissions and Settings:** Review **all certificate templates** in the CA’s scope (especially those that are enabled for issuance). For each template, follow the principle of least privilege:
  - Limit the **Enrollment Permissions** to only the specific users or groups that truly need that certificate. For instance, normal domain users likely do not need to enroll in the Web Server or Domain Controller templates – remove any broad groups like Authenticated Users from those ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=%2A%20ADCS%20templates%20where%20low,certificate%20enrollment%20rights%2C%20allowing%20requesters)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,security%20settings%20within%20these%20templates)). A critical check is to ensure no high-privilege templates (e.g., Domain Controller, Admin templates) are open to low-priv accounts.
  - Disable the “**Enrollee Supplies Subject**” flag (`CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT`) on templates unless absolutely required ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,security%20settings%20within%20these%20templates)). In almost all cases, standard user or computer certificates can use the subject from AD automatically. If you do need to allow custom SANs (for example, on a certificate for web services), consider restricting who can enroll that template and require an approval or authorization.
  - Require **manager approval** or **authorized signatures** for sensitive templates. This introduces a manual checkpoint – even if an attacker has enroll permissions, the request will sit pending until an admin approves. It’s not foolproof (a compromised CA manager could approve their own request), but it can deter automated exploitation.
  - Remove dangerous EKUs from templates that don’t need them. For instance, if a certificate template is meant strictly for email encryption, ensure it doesn’t inadvertently also allow client authentication (or, if it has Any Purpose EKU, consider defining specific EKUs instead) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)). Likewise, if a template was copied from the Enrollment Agent template and isn’t needed, remove that ability.
  - Audit the template **ACLs** for ESC4 issues. Only enterprise PKI admins should have full control or write permissions on templates. Regular domain users should not appear on the ACL except perhaps for *Enroll* and *Read* permissions as explicitly intended. If any template shows unusual ACEs (e.g., a subordinate admin group with write permissions), fix it.

- **Restrict and Monitor CA Permissions:** Only highly trusted accounts should have roles like CA Administrator or Certificate Manager on the CA (usually members of a dedicated PKI Admins group). Remove any redundant or legacy principals from the CA’s ACL. Enforce the rule that membership in those groups is tightly controlled and monitored. Since a CA compromise is so critical (ESC5/ESC7), treat the CA like a domain controller in terms of security: use a hardened dedicated server, consider running the CA service under a minimally privileged account, and enable auditing for CA access. If possible, utilize a **Hardware Security Module (HSM)** for the CA’s key to make theft of the key harder even if the server is owned – an HSM can enforce that keys never leave the device.

- **Network Segmentation and Authentication Silos:** Place your ADCS servers on a secure network segment. Limit who can reach the CA – domain members will need to for enrollment, but internet or untrusted segments should not. Implementing authentication silos or PAWs (Privileged Access Workstations) for managing the CA can reduce risk of a random compromised user affecting the CA. Additionally, disable NTLM domain-wide if feasible; it breaks many things, but it’s the ultimate solution to NTLM relay.

- **Certificate Lifecycle Hygiene:** Enforce short validity periods on high-privilege certificates and regularly review issued certificates. If a certificate was issued for a Domain Admin, is that expected? Certificate transparency is not just for public CAs – create an inventory of all certificates issued by your ADCS and their purposes. This can help spot a rogue cert if one was issued. Also, configure **auto-enrollment** carefully; while auto-enrollment by itself isn’t an attack, it could automatically enroll a malicious certificate if an attacker managed to push a template into a group policy auto-enroll (a less common vector).

- **Use Microsoft’s Recommendations & Tools:** Microsoft has published guidance for ADCS including scripts to enumerate vulnerable configurations (e.g., `CertTemplateKevlar.xml` and PKIView). The NSA & CISA guidance on protecting ADCS (as part of their top ten misconfigurations) is a good checklist ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,security%20settings%20within%20these%20templates)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,and%20Network%20security%20Restrict%20NTLM)). For instance, they advise disabling web enrollment if not needed, and disabling the enrollee-supplied subject altogether – concrete steps which we echoed above. Keep ADCS servers updated (e.g., apply patches for known issues like PetitPotam CVE-2021-36942 and others ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,controls%20to%20protect%20the%20infrastructure))).

- **Incident Response Readiness:** Because certificate abuse can lead to stealthy persistence (a cert can be valid for months/years and is not visible like a user account would be), have an IR plan for certificate-based attacks. This includes knowing how to: **revoke a compromised certificate** (and publish CRL immediately), map a certificate thumbprint to the requestor and issuance time from CA logs, and potentially **reissue a new CA** if the CA’s key is suspect (in worst-case scenarios of ESC5). Also, monitor the *Certificate Services* role on servers – if suddenly a new CA is installed on a machine (event logs or new services appear), that could be an attacker setting up a rogue CA.

By implementing the above mitigations, organizations can significantly reduce the risk of ADCS-based privilege escalation. The theme is to eliminate the unnecessary: if a feature or permission in ADCS isn’t needed, turn it off or lock it down. For necessary features, apply the *least privilege* principle and compensating controls like approvals or monitoring. ADCS, when properly configured, can continue to provide its intended security benefits without serving as an attacker’s express lane to domain dominance.

## Conclusion 
Active Directory Certificate Services has become a **double-edged sword** in enterprise security. On one hand, it enables stronger authentication and secure communications through the use of certificates. On the other hand, if misconfigured, it offers attackers a path to silently **escalate privileges and even persist** with stealthy access. Windows Event Code 39 has emerged as an important signal in this context, flagging attempts at certificate-based logons that bypass newer security checks. For defenders, understanding Event 39 and the underlying certificate mapping changes is key to catching illicit certificate usage in action ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)). 

We explored how attackers exploit ADCS via known escalation techniques ESC1–ESC8 – from forging certificates via vulnerable templates to relaying NTLM to a CA web service. These scenarios demonstrate that **relatively trivial mistakes** (like an overly permissive template or an enabled HTTP endpoint) can lead to a full **domain compromise**. Real incidents, such as the abuse of CVE-2022-26923 to gain Domain Admin ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)) and the PetitPotam NTLM relay attacks ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)), reinforce that this is not just a hypothetical threat. Attackers are actively adding ADCS exploits to their playbooks, drawn by the prospect of **credential-free domain escalation** that may evade traditional detection ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=While%20CVE,the%20end%20of%20this%20post)).

The good news is that with awareness and diligence, these attacks can be mitigated. Enterprise defenders should **harden their ADCS deployments** by fixing template permissions, locking down CA settings, and applying patches that enforce strong certificate mappings ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=compatibility%20issues%20may%20have%20prevented,the%20end%20of%20this%20post)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,security%20settings%20within%20these%20templates)). In tandem, **robust monitoring** – via Windows events (39 and others), tools like Sysmon, and advanced solutions like Microsoft Defender for Identity – can provide the visibility needed to detect and respond to certificate abuse attempts. When a suspicious certificate event is caught, organizations must react quickly: revoke rogue certificates, investigate the scope (Was the CA compromised? Which accounts were impersonated?), and remediate the misconfiguration that allowed it.

In conclusion, ADCS should be treated as a **Tier-0 asset** similar to domain controllers. Its compromise has domain-wide impact, and thus it warrants the same level of protection and monitoring. By following the best practices in detection and mitigation outlined above, enterprise defenders can stay ahead of attackers in this evolving domain. As authentication mechanisms evolve, so do attacker tactics – but a solid understanding of your certificate infrastructure and vigilant monitoring of events like Event 39 will tip the balance in favor of the defense.

## References

- SpecterOps (Will Schroeder & Lee Christensen), *“Certified Pre-Owned: Abusing Active Directory Certificate Services”* – whitepaper and blog post summarizing ADCS attack pathways (ESC1–ESC8) ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=For%20the%20past%20several%20months%2C,and%20the%20security%20ramifications%20of)) ([Certified Pre-Owned. Active Directory Certificate Services… | by Will Schroeder | Posts By SpecterOps Team Members](https://posts.specterops.io/certified-pre-owned-d95910965cd2#:~:text=match%20at%20L612%20have%20seen,have%20known%20better%E2%80%9D%20in%20this)).  
- Uwe Gradenegger, *“Details of event ID 39 (Kerberos KDC)”* – explanation of KDC event 39 and the certificate mapping changes introduced in 2022 ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=This%20event%20occurs%20when%20a,or%20even%20smart%20card%20logins)) ([Details of event with ID 39 of source Microsoft-Windows-Kerberos-Key-Distribution-Center - Uwe Gradenegger](https://www.gradenegger.eu/en/details-of-the-event-with-id-39-of-the-source-microsoft-windows-kerberos-key-distribution-center/#:~:text=Event%20text%20,for%20example)).  
- IBM X-Force (John Dwyer et al.), *“Responding to AD CS attacks (X-Force Incident)”* – case study of a 2023 incident where CVE-2022-26923 was exploited to gain Domain Admin ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=Microsoft%20Windows%20that%20enables%20organizations,just%20logged%20as%20a%20warning)) ([Attacker exploits vulnerability in Active Directory Certificate Services to take control of domain | IBM](https://securityintelligence.com/x-force/attacker-exploits-vulnerability-in-active-directory-certificate-services/#:~:text=While%20CVE,the%20end%20of%20this%20post)).  
- NSA/CISA Advisory (2023), *“NSA and CISA Red and Blue Teams Share Top Ten Misconfigurations”* – highlights ADCS misconfigs as a top issue and provides mitigation guidance ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=%2A%20ADCS%20templates%20where%20low,certificate%20enrollment%20rights%2C%20allowing%20requesters)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=,and%20Network%20security%20Restrict%20NTLM)).  
- Microsoft Support KB5014754 – *“Certificate-based authentication changes on Windows domain controllers”* – outlines the new strong mapping enforcement and related registry settings ([KB5014754: Certificate-based authentication changes on Windows domain controllers - Microsoft Support](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16#:~:text=1%20%E2%80%93%20Checks%20if%20there,user%20account%20predates%20the%20certificate)) ([KB5014754: Certificate-based authentication changes on Windows domain controllers - Microsoft Support](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16#:~:text=2%20%E2%80%93%20Checks%20if%20there%E2%80%99s,not%20present%2C%20authentication%20is%20denied)).  
- Microsoft Tech Community, *“Defender for Identity expands coverage with new AD CS sensor”* – announcement of new detections and sensor for ADCS in MDI, with context on ADCS threats ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=While%20AD%20CS%20is%20not,be%20extremely%20easy%20to%20misconfigure)) ([Microsoft Defender for Identity expands its coverage with new AD CS sensor! | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/microsoftthreatprotectionblog/microsoft-defender-for-identity-expands-its-coverage-with-new-ad-cs-sensor/3894215#:~:text=We%20are%20excited%20to%20announce,coverage%20to%20additional%20identity%20environments)).  
- TrustFoundry (Thomas Fieber), *“Understanding AD CS: A Focus on ESC1 and ESC8”* – blog reinforcing how common ESC1/ESC8 are in 2024 and summarizing those attacks ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=,enrollment%20using%20the%20affected%20template)) ([Understanding Active Directory Certificate Services: A Focus on ESC1 and ESC8 - TrustFoundry](https://trustfoundry.net/2024/08/19/understanding-active-directory-certificate-services-a-focus-on-esc1-and-esc8/#:~:text=ESC8,the%20time%20of%20this%20writing)).  
- NCC Group, *“Defending Your Directory: Fortifying AD CS”* – overview of ADCS attacks and mitigations (ESC1–ESC9) from a defensive standpoint ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=ESC1%20,Abuse)) ([Defending Your Directory: An Expert Guide to Fortifying Active Directory Certificate Services (ADCS) Against Exploitation | NCC Group](https://www.nccgroup.com/us/research-blog/defending-your-directory-an-expert-guide-to-fortifying-active-directory-certificate-services-adcs-against-exploitation/#:~:text=,EKU%20configuration)).  
- Crowe, *“Exploiting AD CS: ESC1 and ESC8”* – article describing how ADCS exploitation became mainstream post-2021 and the impact of Microsoft’s patch on these attacks ([Exploiting AD CS: A quick look at ESC1 and ESC8 | Crowe LLP](https://www.crowe.com/cybersecurity-watch/exploiting-ad-cs-a-quick-look-at-esc1-esc8#:~:text=AD%20CS%20exploitation%20became%20mainstream,affect%20the%20exploitation%20of%20ESC1)) ([NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations | CISA](https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-278a#:~:text=PetitPotam%20NTLM%20Relay%20to%20ADCS,Owned%2C%20Active%20Directory%20Certificate%20Services.%5B10%5D%2C%5B11%5D%2C%5B12)).
